<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡å¸‚åœºæƒ…ç»ªåˆ†æé¢æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid white;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            animation: fadeInUp 0.6s ease-out;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sentiment-score {
            text-align: center;
            padding: 30px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }

        .score-bullish {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .score-bearish {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .score-neutral {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .sentiment-label {
            font-size: 2em;
            font-weight: bold;
            margin: 15px 0;
        }

        .sentiment-time {
            color: #666;
            font-size: 0.9em;
        }

        .index-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .index-name {
            font-weight: bold;
            color: #333;
        }

        .index-value {
            text-align: right;
        }

        .index-price {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .index-change {
            font-size: 0.9em;
            margin-top: 5px;
        }

        .change-up {
            color: #e74c3c;
        }

        .change-down {
            color: #27ae60;
        }

        .breadth-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .stat-up {
            color: #e74c3c;
        }

        .stat-down {
            color: #27ae60;
        }

        .advice-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .advice-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .advice-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .advice-item {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .advice-item h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .advice-item p {
            line-height: 1.6;
            opacity: 0.95;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .score-circle {
                width: 150px;
                height: 150px;
                font-size: 2em;
            }

            .breadth-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Aè‚¡å¸‚åœºæƒ…ç»ªåˆ†æé¢æ¿</h1>
            <p>å®æ—¶æ™ºèƒ½åˆ†æå½“æ—¥å¸‚åœºå¤šç©ºæƒ…ç»ª</p>
            <button class="refresh-btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åŠ è½½å¸‚åœºæ•°æ®...</p>
        </div>

        <div id="dashboard" style="display: none;">
            <!-- æƒ…ç»ªå¾—åˆ† -->
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-title">ğŸ¯ ç»¼åˆæƒ…ç»ªå¾—åˆ†</div>
                    <div class="sentiment-score">
                        <div class="score-circle" id="scoreCircle">
                            <span id="scoreValue">0.00</span>
                        </div>
                        <div class="sentiment-label" id="sentimentLabel">ä¸­æ€§</div>
                        <div class="sentiment-time" id="updateTime">æ›´æ–°æ—¶é—´: --</div>
                    </div>
                </div>

                <!-- å¸‚åœºå¹¿åº¦ -->
                <div class="card">
                    <div class="card-title">ğŸ” å¸‚åœºå¹¿åº¦</div>
                    <div class="breadth-stats">
                        <div class="stat-item">
                            <div class="stat-value stat-up" id="upCount">0</div>
                            <div class="stat-label">ä¸Šæ¶¨è‚¡ç¥¨</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value stat-down" id="downCount">0</div>
                            <div class="stat-label">ä¸‹è·Œè‚¡ç¥¨</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" style="color: #e74c3c;" id="limitUp">0</div>
                            <div class="stat-label">æ¶¨åœæ¿</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" style="color: #27ae60;" id="limitDown">0</div>
                            <div class="stat-label">è·Œåœæ¿</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸»è¦æŒ‡æ•° -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-title">ğŸ“ˆ ä¸»è¦æŒ‡æ•°è¡¨ç°</div>
                <div id="indicesList"></div>
            </div>

            <!-- æ“ä½œå»ºè®® -->
            <div class="advice-section">
                <div class="advice-title">ğŸ’¡ æ“ä½œå»ºè®®</div>
                <div class="advice-content" id="adviceContent"></div>
            </div>

            <!-- å†å²è¶‹åŠ¿å›¾ -->
            <div class="chart-container">
                <div class="card-title">ğŸ“Š æƒ…ç»ªå†å²è¶‹åŠ¿</div>
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>

        <div class="footer">
            <p>é‡åŒ–äº¤æ˜“ç³»ç»Ÿ v2.0 | æ•°æ®ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</p>
            <p>æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ… ğŸ“ˆğŸ’°</p>
        </div>
    </div>

    <script>
        let sentimentChart = null;
        let sentimentHistory = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            // æ¯60ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(refreshData, 60000);
        });

        async function refreshData() {
            const loading = document.getElementById('loading');
            const dashboard = document.getElementById('dashboard');

            loading.style.display = 'block';
            dashboard.style.display = 'none';

            try {
                // è°ƒç”¨åç«¯APIè·å–æ•°æ®
                const response = await fetch('/api/sentiment');
                const data = await response.json();

                if (data.success) {
                    updateDashboard(data.data);
                    loading.style.display = 'none';
                    dashboard.style.display = 'block';
                } else {
                    // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    const mockData = generateMockData();
                    updateDashboard(mockData);
                    loading.style.display = 'none';
                    dashboard.style.display = 'block';
                }
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const mockData = generateMockData();
                updateDashboard(mockData);
                loading.style.display = 'none';
                dashboard.style.display = 'block';
            }
        }

        function generateMockData() {
            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            const score = (Math.random() * 2 - 1).toFixed(3);
            const sentiment = getSentimentLabel(parseFloat(score));

            const indices = [
                { name: 'ä¸Šè¯æŒ‡æ•°', price: 3200 + Math.random() * 100, change: (Math.random() * 4 - 2) },
                { name: 'æ·±è¯æˆæŒ‡', price: 10500 + Math.random() * 200, change: (Math.random() * 4 - 2) },
                { name: 'åˆ›ä¸šæ¿æŒ‡', price: 2000 + Math.random() * 100, change: (Math.random() * 4 - 2) },
                { name: 'æ²ªæ·±300', price: 3800 + Math.random() * 100, change: (Math.random() * 4 - 2) },
                { name: 'ä¸­è¯500', price: 5500 + Math.random() * 100, change: (Math.random() * 4 - 2) }
            ];

            const total = Math.floor(4500 + Math.random() * 700);
            const upRatio = 0.3 + Math.random() * 0.4;
            const upCount = Math.floor(total * upRatio);
            const downCount = Math.floor(total * (1 - upRatio) * 0.95);
            const flatCount = total - upCount - downCount;

            return {
                score: parseFloat(score),
                sentiment: sentiment,
                indices: indices,
                breadth: {
                    total: total,
                    upCount: upCount,
                    downCount: downCount,
                    flatCount: flatCount,
                    limitUp: Math.floor(Math.random() * 80),
                    limitDown: Math.floor(Math.random() * 80)
                },
                timestamp: new Date().toISOString()
            };
        }

        function getSentimentLabel(score) {
            if (score >= 0.6) return 'å¼ºçƒˆçœ‹å¤š ğŸš€';
            if (score >= 0.3) return 'çœ‹å¤š ğŸ“ˆ';
            if (score >= 0.1) return 'åå¤š â†—ï¸';
            if (score > -0.1) return 'ä¸­æ€§ â¡ï¸';
            if (score > -0.3) return 'åç©º â†˜ï¸';
            if (score > -0.6) return 'çœ‹ç©º ğŸ“‰';
            return 'å¼ºçƒˆçœ‹ç©º ğŸ’¥';
        }

        function getSentimentClass(score) {
            if (score >= 0.1) return 'score-bullish';
            if (score > -0.1) return 'score-neutral';
            return 'score-bearish';
        }

        function getAdvice(score) {
            if (score >= 0.6) {
                return [
                    { title: 'ä»“ä½å»ºè®®', content: 'å»ºè®®ç§¯æåšå¤šï¼Œå¯é€‚å½“å¢åŠ ä»“ä½è‡³80-100%' },
                    { title: 'æ“ä½œç­–ç•¥', content: 'å…³æ³¨å¼ºåŠ¿æ¿å—å’Œé¾™å¤´ä¸ªè‚¡ï¼Œè®¾ç½®æ­¢æŸä¿æŠ¤åˆ©æ¶¦' },
                    { title: 'é£é™©æç¤º', content: 'å¸‚åœºæåº¦å¼ºåŠ¿æ—¶æ³¨æ„å›è°ƒé£é™©ï¼ŒåŠæ—¶æ­¢ç›ˆ' }
                ];
            } else if (score >= 0.3) {
                return [
                    { title: 'ä»“ä½å»ºè®®', content: 'åå¤šæ“ä½œï¼Œå¯ç»´æŒä¸­ç­‰ä»“ä½ï¼ˆ60-70%ï¼‰' },
                    { title: 'æ“ä½œç­–ç•¥', content: 'æ‹©æœºä¹°å…¥ä¼˜è´¨æ ‡çš„ï¼Œç­‰å¾…åŠ ä»“æœºä¼š' },
                    { title: 'é£é™©æç¤º', content: 'æ³¨æ„å›è°ƒé£é™©ï¼ŒåŠæ—¶æ­¢ç›ˆæ­¢æŸ' }
                ];
            } else if (score >= 0.1) {
                return [
                    { title: 'ä»“ä½å»ºè®®', content: 'è½»ä»“è¯•æ¢ï¼Œç»´æŒ30-50%ä»“ä½' },
                    { title: 'æ“ä½œç­–ç•¥', content: 'ç­‰å¾…æ›´æ˜ç¡®ä¿¡å·ï¼Œå¯è€ƒè™‘é«˜æŠ›ä½å¸' },
                    { title: 'é£é™©æç¤º', content: 'å¸‚åœºæ–¹å‘ä¸æ˜ï¼Œæ§åˆ¶ä»“ä½ä¸ºä¸»' }
                ];
            } else if (score > -0.1) {
                return [
                    { title: 'ä»“ä½å»ºè®®', content: 'å»ºè®®å‡ä»“è‡³30%ä»¥ä¸‹æˆ–ç©ºä»“è§‚æœ›' },
                    { title: 'æ“ä½œç­–ç•¥', content: 'ä¸å®œæ¿€è¿›æ“ä½œï¼Œç­‰å¾…å¸‚åœºä¼ç¨³ä¿¡å·' },
                    { title: 'é£é™©æç¤º', content: 'å¤šç©ºå¹³è¡¡ï¼Œç­‰å¾…æ˜ç¡®æ–¹å‘' }
                ];
            } else if (score > -0.3) {
                return [
                    { title: 'ä»“ä½å»ºè®®', content: 'ä¸¥æ ¼æ§åˆ¶ä»“ä½åœ¨20%ä»¥ä¸‹' },
                    { title: 'æ“ä½œç­–ç•¥', content: 'é¿å…æŠ„åº•ï¼Œç­‰å¾…å¸‚åœºä¼ç¨³' },
                    { title: 'é£é™©æç¤º', content: 'å…³æ³¨é˜²å¾¡æ€§æ¿å—ï¼Œä»¥é˜²å®ˆä¸ºä¸»' }
                ];
            } else {
                return [
                    { title: 'ä»“ä½å»ºè®®', content: 'ä¸¥æ ¼ç©ºä»“æˆ–æä½ä»“ä½ï¼ˆ<10%ï¼‰' },
                    { title: 'æ“ä½œç­–ç•¥', content: 'é¿å…æŠ„åº•ï¼Œç­‰å¾…æ˜ç¡®ä¼ç¨³ä¿¡å·' },
                    { title: 'é£é™©æç¤º', content: 'ä¿æŠ¤èµ„é‡‘å®‰å…¨ä¸ºç¬¬ä¸€è¦åŠ¡ï¼Œå¯è€ƒè™‘åšç©º' }
                ];
            }
        }

        function updateDashboard(data) {
            // æ›´æ–°æƒ…ç»ªå¾—åˆ†
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = document.getElementById('scoreValue');
            const sentimentLabel = document.getElementById('sentimentLabel');
            const updateTime = document.getElementById('updateTime');

            scoreCircle.className = 'score-circle ' + getSentimentClass(data.score);
            scoreValue.textContent = data.score.toFixed(3);
            sentimentLabel.textContent = data.sentiment;
            updateTime.textContent = 'æ›´æ–°æ—¶é—´: ' + new Date(data.timestamp).toLocaleString('zh-CN');

            // æ›´æ–°å¸‚åœºå¹¿åº¦
            document.getElementById('upCount').textContent = data.breadth.upCount;
            document.getElementById('downCount').textContent = data.breadth.downCount;
            document.getElementById('limitUp').textContent = data.breadth.limitUp;
            document.getElementById('limitDown').textContent = data.breadth.limitDown;

            // æ›´æ–°æŒ‡æ•°åˆ—è¡¨
            const indicesList = document.getElementById('indicesList');
            indicesList.innerHTML = data.indices.map(index => {
                const changeClass = index.change >= 0 ? 'change-up' : 'change-down';
                const changeIcon = index.change >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
                return `
                    <div class="index-item">
                        <div class="index-name">${index.name}</div>
                        <div class="index-value">
                            <div class="index-price">${index.price.toFixed(2)}</div>
                            <div class="index-change ${changeClass}">
                                ${index.change >= 0 ? '+' : ''}${index.change.toFixed(2)}% ${changeIcon}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // æ›´æ–°æ“ä½œå»ºè®®
            const adviceContent = document.getElementById('adviceContent');
            const advice = getAdvice(data.score);
            adviceContent.innerHTML = advice.map(item => `
                <div class="advice-item">
                    <h3>${item.title}</h3>
                    <p>${item.content}</p>
                </div>
            `).join('');

            // æ›´æ–°å†å²å›¾è¡¨
            updateChart(data);
        }

        function updateChart(data) {
            // æ·»åŠ åˆ°å†å²æ•°æ®
            sentimentHistory.push({
                time: new Date(data.timestamp).toLocaleTimeString('zh-CN'),
                score: data.score
            });

            // ä¿ç•™æœ€è¿‘20æ¡æ•°æ®
            if (sentimentHistory.length > 20) {
                sentimentHistory = sentimentHistory.slice(-20);
            }

            const ctx = document.getElementById('sentimentChart').getContext('2d');

            if (sentimentChart) {
                sentimentChart.destroy();
            }

            sentimentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sentimentHistory.map(d => d.time),
                    datasets: [{
                        label: 'æƒ…ç»ªå¾—åˆ†',
                        data: sentimentHistory.map(d => d.score),
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            min: -1,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    if (value >= 0.6) return 'å¼ºçƒˆçœ‹å¤š';
                                    if (value >= 0.3) return 'çœ‹å¤š';
                                    if (value >= 0.1) return 'åå¤š';
                                    if (value > -0.1) return 'ä¸­æ€§';
                                    if (value > -0.3) return 'åç©º';
                                    if (value > -0.6) return 'çœ‹ç©º';
                                    return 'å¼ºçƒˆçœ‹ç©º';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
